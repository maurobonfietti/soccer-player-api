x-common-variables: &common-variables
  NODE_ENV: local
  AWS_ACCESS_KEY_ID: anykey
  AWS_SECRET_ACCESS_KEY: anysecret
  AWS_REGION: us-east-2
services:
  local:
    build:
      context: .
    image: soccer-player-api
    volumes:
      - ./src:/app/src
    container_name: soccer-player-api_local
    environment: *common-variables
    ports:
      - "3000:3000"
      - "9229:9229"
    tty: true
    entrypoint: ["npm", "run", "local"]
  test:
    build:
      context: .
    image: soccer-player-api
    volumes:
      - ./src:/app/src
      - ./coverage/unit:/app/coverage
    container_name: soccer-player-api_test
    environment: *common-variables
    tty: true
    entrypoint: ["npm", "test"]
  localstack:
    image: localstack/localstack
    container_name: soccer-player-api_localstack
    environment:
      SERVICES: dynamodb
    ports:
      - "4566:4566"
  setup:
    image: amazon/aws-cli:latest
    container_name: soccer-player-api_setup
    volumes:
      - ./setup:/setup
    environment:
      AWS_ACCESS_KEY_ID: anykey
      AWS_SECRET_ACCESS_KEY: anysecret
      AWS_DEFAULT_REGION: us-east-2
    depends_on:
      - localstack
    entrypoint: [""]
    command: ["/setup/setup.sh"]
networks: 
  default:
    name: soccer-player-api
